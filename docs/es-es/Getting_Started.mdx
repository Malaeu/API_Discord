<LocalePicker currentLocale="es-ES" />

# Creando tu primera aplicaci√≥n de Discord
Las aplicaciones de Discord te permiten personalizar y ampliar tus servidores utilizando una colecci√≥n de API y funciones interactivas. Esta gu√≠a te ense√±ar√° a crear tu primera aplicaci√≥n de Discord con JavaScript, y al final tendr√°s una aplicaci√≥n que utiliza comandos slash, env√≠a mensajes y responde a las interacciones de los componentes.

Construiremos una aplicaci√≥n de Discord que permita a los miembros del servidor jugar piedra, papel o tijera (con 7 opciones en lugar de las 3 habituales). Esta gu√≠a est√° enfocada para principiantes, pero asume que tienes una comprensi√≥n b√°sica de [JavaScript](https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics).

<Collapsible title="Lo que crearemos" icon="view">
  As√≠ ser√° el resultado de la aplicaci√≥n:

  ![Demo of example app](getting-started-demo.gif)

  Para hacer el flujo del usuario un poco m√°s expl√≠cito:
  1. El usuario 1 inicia un nuevo juego y elige su objeto utilizando el comando slash `/challenge` de la aplicaci√≥n.
  2. Se env√≠a un mensaje al canal con un bot√≥n que invita a otros a aceptar el desaf√≠o.
  3. El usuario 2 presiona el bot√≥n **Accept**.
  4. Se env√≠a un mensaje ef√≠mero al usuario 2, donde selecciona su objeto de elecci√≥n.
  5. El resultado del juego se publica nuevamente en el canal original para que todos lo vean.
</Collapsible>

<Collapsible title="Recursos utilizados en esta gu√≠a" description="Resumen de las herramientas y tecnolog√≠as que utilizaremos" icon="list">
  - **[Repositorio GitHub](https://github.com/discord/discord-example-app)** donde se encuentra el c√≥digo de esta gu√≠a, junto con algunos ejemplos de c√≥digo adicionales espec√≠ficos de caracter√≠sticas.
  - **[discord-interactions](https://github.com/discord/discord-interactions-js)**, es una biblioteca que proporciona tipos y funciones auxiliares para las aplicaciones de Discord.
  - **[Express](https://expressjs.com)**, es un framework web popular de JavaScript, que usaremos para crear un servidor donde Discord pueda enviarnos solicitudes.
  - **[Glitch](https://glitch.com/)**, es un entorno en l√≠nea que simplifica tanto la creaci√≥n como el alojamiento de aplicaciones durante las fases iniciales de desarrollo y prototipado. Tambi√©n puede desarrollar localmente con una herramienta como **[ngrok](https://ngrok.com/)**.
</Collapsible>

---

## Paso 1: Crear una aplicaci√≥n

Primero, necesitas crear una aplicaci√≥n en el Developer Portal si a√∫n no tienes una:

<Button href="https://discord.com/developers/applications?new_application=true" color="brand">Crear aplicaci√≥n</Button>

Escriba un nombre para su aplicaci√≥n, luego presiona **Create**.

Despu√©s de crear tu aplicaci√≥n, llegar√°s a la p√°gina **General Information** de la aplicaci√≥n, donde podr√°s actualizar la informaci√≥n b√°sica sobre tu aplicaci√≥n, como su descripci√≥n e icono. Tambi√©n encontrar√°s un **Application ID** e **Interactions Endpoint URL**, los cuales utilizaremos m√°s adelante en esta gu√≠a.

### Configurando tu bot

A continuaci√≥n, configuraremos el [Usuario bot](#DOCS_TOPICS_OAUTH2/bot-vs-user-accounts) para tu aplicaci√≥n, lo cual le permitir√° aparecer y comportarse de manera similar a otros miembros del servidor.

En la barra de navegaci√≥n izquierda da clic en **Bot**. En esta p√°gina, puedes configurar los ajustes [privileged intents](#DOCS_TOPICS_GATEWAY/privileged-intents) o si pueden ser a√±adidos por otros usuarios.

<Collapsible title="¬øQu√© son las intents?" description="Introducci√≥n para intens est√°ndaras y privilegiadas." icon="question">
  Las intents determinan qu√© eventos enviar√° Discord a tu aplicaci√≥n cuando crees una [conexi√≥n Gateway API](#DOCS_TOPICS_GATEWAY). Por ejemplo, si quieres que tu app haga algo cuando los usuarios agreguen una reacci√≥n a un mensaje, puedes pasar la intent `GUILD_MESSAGE_REACTIONS` (`1 << 10`).

  Algunos intents tienen [privilegios](#DOCS_TOPICS_GATEWAY/privileged-intents), lo que significa que tu aplicaci√≥n tiene la capacidad de acceder a datos potencialmente confidenciales (como el contenido de los mensajes). Las intents con privilegios aparecen y se pueden alternar en la p√°gina **Bot** en la configuraci√≥n de la aplicaci√≥n. Las intents est√°ndar sin privilegios no necesitan permisos ni configuraciones adicionales.

  Para obtener m√°s informaci√≥n sobre las intents y una lista completa de las intents disponibles, junto con sus eventos asociados, consulte la [documentaci√≥n Gateway](#DOCS_TOPICS_GATEWAY/gateway-intents).
</Collapsible>

![Pesta√±a de Bot en la configuraci√≥n de la aplicaci√≥n](app-add-bot.png)

Tambi√©n hay una secci√≥n **Token** en la p√°gina **Bot**, que te permite copiar y restablecer el token de tu bot.

Los tokens de bot se utilizan para autorizar solicitudes de API y llevan los permisos de tu bot, lo que los hace *altamente sensibles*. Aseg√∫rate de *nunca* compartir tu token o ingresarlo en ning√∫n tipo de control de versiones.

Adelante, copia el token y gu√°rdalo en un lugar seguro (como en un administrador de contrase√±as).

> warn
> No podr√°s ver tu token de nuevo a menos que lo regeneres, as√≠ que aseg√∫rate de guardarlo en un lugar seguro.

### Agregando alcances y permisos de bot

Las aplicaciones necesitan la aprobaci√≥n de los usuarios que las instalan para realizar acciones en Discord (como crear un comando slash o buscar una lista de miembros del servidor). Vamos a seleccionar algunos alcances y permisos para solicitar antes de instalar la aplicaci√≥n.

<Collapsible title="¬øQu√© son los alcances y los permisos?" description="Introducci√≥n a los alcances y permisos de bot" icon="question">
  Al crear una aplicaci√≥n, los alcances y permisos determinan lo que tu aplicaci√≥n puede hacer y acceder en los servidores de Discord.

  - Los [Alcances de OAuth2](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes) determinan qu√© acceso a datos y acciones puede tomar tu aplicaci√≥n, otorgado en nombre de un usuario que instala o autentica.
  - Los [Permisos](#DOCS_TOPICS_PERMISSIONS/permission-overwrites) son los permisos asignados para tu usuario bot, los mismos que tienen otros usuarios en Discord. Pueden ser aprobados por el usuario que instala o actualiza m√°s tarde dentro de la configuraci√≥n del servidor o con [sobrescrituras de permisos](#DOCS_TOPICS_PERMISSIONS/permission-overwrites).
</Collapsible>

Haz clic en **OAuth2** en la barra lateral izquierda, luego selecciona **Generador de URL**.

> info
> El generador de URL crea un enlace de instalaci√≥n basado en los alcances y permisos que seleccionas para tu aplicaci√≥n. Puedes usar el enlace para instalar la aplicaci√≥n en tu propio servidor, o compartirlo con otros para que puedan instalarla.

Por ahora, solo agrega el alcance **`bot`**, que agrega tu usuario bot.

Despu√©s de seleccionar `bot`, tambi√©n puedes seleccionar diferentes permisos para tu bot. Por ahora, solo marca **Enviar mensajes**.

Consulta la lista de todos los [alcances de OAuth2](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes), o lee m√°s sobre los [permisos](#DOCS_TOPICS_PERMISSIONS) en la documentaci√≥n.

### Instalando tu aplicaci√≥n

Una vez que agregues los alcances, deber√≠as ver una URL que puedes copiar para instalar tu aplicaci√≥n.

![Captura de pantalla del generador de URL](url-generator.png)

> info
> Cuando est√©s desarrollando aplicaciones, deber√≠as construir y probar en un servidor que no est√© siendo utilizado activamente por otros. Si a√∫n no tienes tu propio servidor, puedes [crear uno gratis](https://support.discord.com/hc/en-us/articles/204849977-How-do-I-create-a-server-).

Copia la URL de arriba y p√©gala en tu navegador. Ser√°s guiado a trav√©s del flujo de instalaci√≥n, donde debes asegurarte de que est√°s instalando tu aplicaci√≥n en un servidor donde puedas desarrollarla y probarla.

Despu√©s de instalar tu aplicaci√≥n, puedes dirigirte a tu servidor y ver que se ha unido ‚ú®

Con tu aplicaci√≥n configurada e instalada, comencemos a desarrollarla.

---

## Paso 2: Ejecutando tu aplicaci√≥n

Todo el c√≥digo utilizado en la aplicaci√≥n de ejemplo se puede encontrar en [el repositorio de GitHub](https://github.com/discord/discord-example-app).

Para simplificar un poco el desarrollo, la aplicaci√≥n utiliza [discord-interactions](https://github.com/discord/discord-interactions-js), que proporciona tipos y funciones auxiliares. Si prefieres usar otros lenguajes o bibliotecas, consulta la documentaci√≥n de [Recursos de la Comunidad](#DOCS_TOPICS_COMMUNITY_RESOURCES).

### Remixando el proyecto

Esta gu√≠a utiliza Glitch, que te permite clonar y desarrollar dentro de tu navegador. Si prefieres desarrollar tu aplicaci√≥n localmente, hay instrucciones sobre c√≥mo usar ngrok [en el README](https://github.com/discord/discord-example-app#running-app-locally).

> info
> Aunque Glitch es genial para el desarrollo y las pruebas, [tiene restricciones t√©cnicas](https://help.glitch.com/kb/article/17-technical-restrictions/) por lo que se deber√≠an considerar otros proveedores de alojamiento para aplicaciones en producci√≥n.

Para comenzar, **[remixa (o clona) el proyecto Glitch üéè](https://glitch.com/edit/#!/import/git?url=https://github.com/discord/discord-example-app.git)**.

Una vez que remezcles el proyecto, aterrizar√°s en un nuevo proyecto Glitch.

<Collapsible title="Interfaz del proyecto Glitch" description="Visi√≥n general de la interfaz del proyecto Glitch" icon="view">
  ![Visi√≥n general del proyecto Glitch](glitch-project.png)

  - Tu **nombre del proyecto** es un nombre √∫nico para tu proyecto, que se encuentra en la esquina superior izquierda
  - **`.env`** es el archivo donde se almacenar√°n todas tus credenciales para tu aplicaci√≥n
  - **Logs** es donde se encuentra la salida de tu proyecto, esto es √∫til para ver si la aplicaci√≥n est√° funcionando o informaci√≥n sobre cualquier error que encuentre tu aplicaci√≥n
  - El bot√≥n **Share** en la esquina superior derecha es donde encontrar√°s la URL del proyecto en vivo, que necesitar√°s para configurar la interactividad m√°s adelante en esta gu√≠a
</Collapsible>

#### Estructura del proyecto

Todos los archivos del proyecto est√°n en el lado izquierdo de tu proyecto Glitch. A continuaci√≥n, se muestra una descripci√≥n general de las carpetas y archivos principales:

```
‚îú‚îÄ‚îÄ examples    -> aplicaciones de muestra espec√≠ficas y cortas
‚îÇ   ‚îú‚îÄ‚îÄ app.js  -> c√≥digo finalizado de app.js
‚îÇ   ‚îú‚îÄ‚îÄ button.js
‚îÇ   ‚îú‚îÄ‚îÄ command.js
‚îÇ   ‚îú‚îÄ‚îÄ modal.js
‚îÇ   ‚îú‚îÄ‚îÄ selectMenu.js
‚îú‚îÄ‚îÄ .env        -> tus credenciales e IDs
‚îú‚îÄ‚îÄ app.js      -> punto de entrada principal para la aplicaci√≥n
‚îú‚îÄ‚îÄ commands.js -> cargas √∫tiles de comandos slash + ayudantes
‚îú‚îÄ‚îÄ game.js     -> l√≥gica espec√≠fica para RPS
‚îú‚îÄ‚îÄ utils.js    -> funciones de utilidad y enumeraciones
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ .gitignore
```

### Instalando comandos slash

> info
> Para instalar comandos slash, la aplicaci√≥n est√° utilizando [`node-fetch`](https://github.com/node-fetch/node-fetch). Puedes ver la implementaci√≥n para la instalaci√≥n en `utils.js` dentro de la funci√≥n `DiscordRequest()`.

El proyecto contiene un script `register` que puedes usar para instalar los comandos en `ALL_COMMANDS`, que se define en la parte inferior de `commands.js`. Instala los comandos como comandos globales llamando al endpoint [`PUT /applications/<APP_ID>/commands`](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/bulk-overwrite-global-application-commands) de la API HTTP.

Si quieres personalizar tus comandos o agregar otros adicionales, puedes hacer referencia a la estructura del comando en la [documentaci√≥n de comandos](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-structure).

Ejecuta el script `register` haciendo clic en **Terminal** en la parte inferior de tu proyecto Glitch y pegando el siguiente comando:

```
npm run register
```

Presiona enter para ejecutar el comando.

Si navegas de vuelta a tu servidor, deber√≠as ver los comandos slash aparecer. Pero si intentas ejecutarlos, no suceder√° nada ya que tu aplicaci√≥n no est√° recibiendo ni manejando ninguna solicitud de Discord.

<Collapsible title="¬øQu√© son las APIs de Discord?" description="Visi√≥n general de las APIs HTTP y Gateway de Discord" icon="question">
  Discord tiene dos APIs que puedes combinar y mezclar para construir aplicaciones:

  - **[HTTP API](#DOCS_REFERENCE/http-api)** es una API tipo REST para operaciones generales como enviar y actualizar datos en Discord, o buscar datos sobre un recurso.
  - **[Gateway API](#DOCS_REFERENCE/gateway-websocket-api)** es una API basada en WebSocket que es √∫til para mantener el estado o escuchar eventos que ocurren en un servidor de Discord. No la usaremos en esta gu√≠a, pero puedes encontrar m√°s informaci√≥n sobre c√≥mo crear una conexi√≥n Gateway y los diferentes eventos que puedes escuchar en la [documentaci√≥n de Gateway](#DOCS_TOPICS_GATEWAY).
</Collapsible>

---

## Paso 3: Manejo de la interactividad

Para permitir que tu aplicaci√≥n reciba solicitudes de comandos slash (y otras interacciones), Discord necesita una URL p√∫blica para enviarlas. Esta URL se puede configurar en la configuraci√≥n de tu aplicaci√≥n como **URL del punto final de interacci√≥n**.

### Agregando una URL de punto final de interacci√≥n

Los proyectos de Glitch tienen una URL p√∫blica expuesta por defecto. Copia la URL de tu proyecto haciendo clic en el bot√≥n **Share** en la esquina superior derecha, luego copia el enlace del "sitio en vivo" que se encuentra en la parte inferior del modal.

> info
> Si est√°s desarrollando localmente, hay instrucciones para hacer tunneling de las solicitudes a tu entorno local [en el README de GitHub](https://github.com/discord/discord-example-app#running-app-locally).

Con el enlace copiado, ve a la configuraci√≥n de tu aplicaci√≥n desde [el portal de desarrolladores](https://discord.com/developers/applications).

En la p√°gina **General Information** de tu aplicaci√≥n, hay una opci√≥n **Interactive Endpoint URL**, donde puedes pegar la URL de tu aplicaci√≥n y agregar `/interactions` al final, que es donde la aplicaci√≥n Express est√° configurada para escuchar las solicitudes.

![URL de punto final de interacciones en la configuraci√≥n de la aplicaci√≥n](interactions-url.png)

Haz clic en **Save Changes** y aseg√∫rate de que tu punto final est√© verificado correctamente.

La aplicaci√≥n de ejemplo maneja la verificaci√≥n de dos maneras:
- Utiliza la `PUBLIC_KEY` y el paquete [discord-interactions](https://github.com/discord/discord-interactions-js#usage) con una funci√≥n de envoltura (importada de `utils.js`) que la hace cumplir con la interfaz `verify` de [Express](http://expressjs.com/en/5x/api.html#express.json). Esto se ejecuta en cada solicitud entrante a tu aplicaci√≥n.
- Responde a las solicitudes `PING` entrantes.

Puedes aprender m√°s sobre c√≥mo preparar tu aplicaci√≥n para recibir interacciones en [la documentaci√≥n de interacciones](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/receiving-an-interaction).

### Manejando las solicitudes de comandos slash

Con el punto final verificado, navega al archivo `app.js` de tu proyecto y encuentra el bloque de c√≥digo que maneja el comando `/test`:

```javascript
// Comando "test"
if (name === 'test') {
    // Env√≠a un mensaje al canal desde donde se activ√≥ el comando
    return res.send({
    type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
    data: {
        // Obtiene un emoji aleatorio para enviar desde una funci√≥n auxiliar
        content: 'hola mundo ' + getRandomEmoji(),
    },
    });
}
```

El c√≥digo anterior est√° respondiendo a la interacci√≥n con un mensaje en el canal desde donde se origin√≥. Puedes ver todos los tipos de respuesta disponibles, como responder con un modal, [en la documentaci√≥n](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-response-object-interaction-callback-type).

> info
> `InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE` es una constante [exportada desde `discord-interactions`](https://github.com/discord/discord-interactions-js/blob/main/src/index.ts#L33)

Ve a tu servidor y aseg√∫rate de que el comando slash `/test` de tu aplicaci√≥n funciona. Cuando lo activas, tu aplicaci√≥n deber√≠a enviar un mensaje que contiene "hola mundo" seguido de un emoji aleatorio.

En la siguiente secci√≥n, agregaremos un comando adicional que utiliza opciones de comandos slash, botones y men√∫s de selecci√≥n para construir el juego de piedra-papel-tijeras.

---

## Paso 4: Agregando componentes de mensaje

El comando `/challenge` ser√° c√≥mo se iniciar√° nuestro juego de estilo piedra-papel-tijeras. Cuando se activa el comando, la aplicaci√≥n enviar√° componentes de mensaje al canal, que guiar√°n a los usuarios para completar el juego.

### Agregando un comando con opciones

El comando `/challenge`, llamado `CHALLENGE_COMMAND` en `commands.js`, tiene un array de `options`. En nuestra aplicaci√≥n, las opciones son objetos que representan diferentes cosas que un usuario puede seleccionar mientras juega a piedra-papel-tijeras, generados usando las claves de `RPSChoices` en `game.js`.

Puedes leer m√°s sobre las opciones de comando y su estructura [en la documentaci√≥n](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-option-structure).

> info
> Aunque esta gu√≠a no tocar√° mucho el archivo `game.js`, si√©ntete libre de explorar y cambiar los comandos o las opciones en los comandos.

<Collapsible title="Manejando la interacci√≥n del comando" description="C√≥digo para manejar el comando de desaf√≠o y responder con un mensaje que contiene un bot√≥n" icon="code" open>
  Para manejar el comando `/challenge`, agrega el siguiente c√≥digo despu√©s del bloque `if name === ‚Äútest‚Äù`:

  ```javascript
    // Comando "challenge"
    if (name === 'challenge' && id) {
        const userId = req.body.member.user.id;
        // Elecci√≥n del objeto del usuario
        const objectName = req.body.data.options[0].value;

        // Crear juego activo usando el ID del mensaje como ID del juego
        activeGames[id] = {
            id: userId,
            objectName,
        };

        return res.send({
        type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
        data: {
            content: `Desaf√≠o de piedra, papel o tijeras de <@${userId}>`,
            components: [
            {
                type: MessageComponentTypes.ACTION_ROW,
                components: [
                {
                    type: MessageComponentTypes.BUTTON,
                    // Agregar el ID del juego para usarlo m√°s tarde
                    custom_id: `accept_button_${req.body.id}`,
                    label: 'Aceptar',
                    style: ButtonStyleTypes.PRIMARY,
                },
                ],
            },
            ],
        },
        });
    }
  ```


  > info
  > Si no est√°s seguro de d√≥nde pegar el c√≥digo, puedes ver el c√≥digo completo en `examples/app.js` en el proyecto Glitch o en el archivo `app.js` principal [en GitHub](https://github.com/discord/discord-example-app/blob/main/app.js).

  El c√≥digo anterior est√° haciendo varias cosas:
  1. Analiza el cuerpo de la solicitud para obtener el ID del usuario que activ√≥ el comando slash (`userId`), y la opci√≥n (elecci√≥n del objeto) que seleccionaron (`objectName`).
  2. Agrega un nuevo juego al objeto `activeGames` usando el ID de la interacci√≥n. El juego activo registra el `userId` y `objectName`.
  3. Env√≠a un mensaje de vuelta al canal con un bot√≥n con un `custom_id` de `accept_button_<SOME_ID>`.

  > warn
  > El c√≥digo de ejemplo utiliza un objeto como almacenamiento en memoria, pero para las aplicaciones de producci√≥n, debes usar una base de datos.

  Al enviar un mensaje con [componentes de mensaje](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/what-is-a-component), las cargas √∫tiles individuales se agregan a un array `components`. Los componentes procesables (como los botones) deben estar dentro de una [fila de acci√≥n](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/action-rows), que puedes ver en el ejemplo de c√≥digo.

  Nota el `custom_id` √∫nico enviado con los componentes del mensaje, en este caso `accept_button_` con el ID del juego activo adjunto. Un `custom_id` se puede usar para manejar las solicitudes que Discord te env√≠a cuando alguien interact√∫a con el componente, lo que ver√°s en un momento.

  Ahora, cuando ejecutes el comando `/challenge` y elijas una opci√≥n, tu aplicaci√≥n enviar√° un mensaje con un bot√≥n **Aceptar**. Vamos a agregar c√≥digo para manejar la presi√≥n del bot√≥n.
</Collapsible>

<Collapsible title="Manejando interacciones de botones" description="C√≥digo para manejar clics de botones y responder con un mensaje ef√≠mero" icon="code" open>
  Cuando los usuarios interact√∫an con un componente de mensaje, Discord enviar√° una solicitud con un [tipo de interacci√≥n](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-object-interaction-type) de `3` (o el valor `MESSAGE_COMPONENT` cuando se usa `discord-interactions`).

  Para configurar un manejador para el bot√≥n, verificaremos el `type` de la interacci√≥n, seguido de la coincidencia con el `custom_id`.

  Pega el siguiente c√≥digo debajo del manejador de tipo para `APPLICATION_COMMAND`s:

  ```javascript
  if (type === InteractionType.MESSAGE_COMPONENT) {
      // custom_id establecido en el payload al enviar el componente de mensaje
      const componentId = data.custom_id;

      if (componentId.startsWith('accept_button_')) {
          // obtener el ID del juego asociado
          const gameId = componentId.replace('accept_button_', '');
          // Eliminar mensaje con token en el cuerpo de la solicitud
          const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;
          try {
              await res.send({
                  type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
                  data: {
                      // Obtiene un emoji aleatorio para enviar desde una funci√≥n auxiliar
                      content: '¬øCu√°l es tu objeto de elecci√≥n?',
                      // Indica que ser√° un mensaje ef√≠mero
                      flags: InteractionResponseFlags.EPHEMERAL,
                      components: [
                      {
                          type: MessageComponentTypes.ACTION_ROW,
                          components: [
                          {
                              type: MessageComponentTypes.STRING_SELECT,
                              // A√±adir ID del juego
                              custom_id: `select_choice_${gameId}`,
                              options: getShuffledOptions(),
                          },
                          ],
                      },
                      ],
                  },
              });
              // Eliminar mensaje anterior
              await DiscordRequest(endpoint, { method: 'DELETE' });
          } catch (err) {
              console.error('Error enviando mensaje:', err);
          }
      }
  }
  ```

  El c√≥digo anterior:
  1. Verifica un `custom_id` que coincida con lo que enviamos originalmente (en este caso, comienza con `accept_button_`). El custom ID tambi√©n tiene el ID del juego activo adjunto, por lo que lo almacenamos en `gameID`.
  2. [Elimina el mensaje original](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/delete-original-interaction-response) llamando a un webhook usando `node-fetch` y pasando el `token` de interacci√≥n √∫nico en el cuerpo de la solicitud. Esto se hace para limpiar el canal y para que otros usuarios no puedan hacer clic en el bot√≥n.
  3. Responde a la solicitud enviando un mensaje que contiene un men√∫ de selecci√≥n con las opciones de objeto para el juego. El payload deber√≠a parecerse bastante al anterior, con la excepci√≥n del array `options` y `flags: 64`, [que indica que el mensaje es ef√≠mero](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/create-followup-message).

  El array `options` se llena usando el m√©todo `getShuffledOptions()` en `game.js`, que manipula los valores de `RPSChoices` para que se ajusten a la forma de las [opciones de componentes de mensaje](#DOCS_INTERACTIONS_MESSAGE_COMPONENTS/select-menu-object-select-option-structure).
</Collapsible>

<Collapsible title="Manejando las interacciones del men√∫ de selecci√≥n" description="C√≥digo para responder a las interacciones del men√∫ de selecci√≥n y actualizar el estado del juego" icon="code" open>

  Lo √∫ltimo que debemos agregar es el c√≥digo para manejar las interacciones del men√∫ de selecci√≥n y enviar el resultado del juego al canal.

  Dado que los men√∫s de selecci√≥n son solo otro componente de mensaje, el c√≥digo para manejar sus interacciones ser√° casi id√©ntico al de los botones.

  Modifica el c√≥digo anterior para manejar el men√∫ de selecci√≥n:

  ```javascript
  if (type === InteractionType.MESSAGE_COMPONENT) {
      // custom_id establecido en el payload al enviar el componente del mensaje
      const componentId = data.custom_id;

      if (componentId.startsWith('accept_button_')) {
          // obtener el ID del juego asociado
          const gameId = componentId.replace('accept_button_', '');
          // Eliminar el mensaje con el token en el cuerpo de la solicitud
          const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;
          try {
              await res.send({
                  type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
                  data: {
                      content: '¬øCu√°l es tu objeto de elecci√≥n?',
                      // Indica que ser√° un mensaje ef√≠mero
                      flags: InteractionResponseFlags.EPHEMERAL,
                      components: [
                      {
                          type: MessageComponentTypes.ACTION_ROW,
                          components: [
                          {
                              type: MessageComponentTypes.STRING_SELECT,
                              // A√±adir el ID del juego
                              custom_id: `select_choice_${gameId}`,
                              options: getShuffledOptions(),
                          },
                          ],
                      },
                      ],
                  },
              });
              // Eliminar el mensaje anterior
              await DiscordRequest(endpoint, { method: 'DELETE' });
          } catch (err) {
              console.error('Error al enviar el mensaje:', err);
          }
      } else if (componentId.startsWith('select_choice_')) {
          // obtener el ID del juego asociado
          const gameId = componentId.replace('select_choice_', '');

          if (activeGames[gameId]) {
              // Obtener el ID del usuario y la elecci√≥n del objeto para el usuario que responde
              const userId = req.body.member.user.id;
              const objectName = data.values[0];
              // Calcular el resultado con la funci√≥n auxiliar
              const resultStr = getResult(activeGames[gameId], {
                  id: userId,
                  objectName,
              });

              // Eliminar el juego del almacenamiento
              delete activeGames[gameId];
              // Actualizar el mensaje con el token en el cuerpo de la solicitud
              const endpoint = `webhooks/${process.env.APP_ID}/${req.body.token}/messages/${req.body.message.id}`;

              try {
                  // Enviar los resultados
                  await res.send({
                      type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
                      data: { content: resultStr },
                  });
                  // Actualizar el mensaje ef√≠mero
                  await DiscordRequest(endpoint, {
                      method: 'PATCH',
                      body: {
                          content: 'Buena elecci√≥n ' + getRandomEmoji(),
                          components: []
                      }
                  });
              } catch (err) {
                  console.error('Error al enviar el mensaje:', err);
              }
          }
      }
  }
  ```

  Al igual que el c√≥digo anterior, el c√≥digo de arriba est√° obteniendo el ID del usuario y su selecci√≥n de objeto de la solicitud de interacci√≥n.

  Esa informaci√≥n, junto con el ID del usuario original y la selecci√≥n del objeto del objeto `activeGames`, se pasa a la funci√≥n `getResult()`. `getResult()` determina el ganador, luego construye una cadena legible para enviar de vuelta al canal.

  Tambi√©n estamos llamando a otro webhook, esta vez para [actualizar el mensaje ef√≠mero de seguimiento](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/edit-followup-message) ya que no puede ser eliminado.

  Finalmente, los resultados se env√≠an al canal utilizando el tipo de respuesta de interacci√≥n `CHANNEL_MESSAGE_WITH_SOURCE`.
</Collapsible>

....y eso es todo üéä Adelante, prueba tu aplicaci√≥n y aseg√∫rate de que todo funcione.

---

## Pr√≥ximos pasos

¬°Felicidades por construir tu primera aplicaci√≥n de Discord! ü§ñ

Esperamos que hayas aprendido un poco sobre las aplicaciones de Discord, c√≥mo configurarlas y c√≥mo hacerlas interactivas. A partir de aqu√≠, puedes continuar desarrollando tu aplicaci√≥n o explorar qu√© m√°s es posible:
- Lee **[la documentaci√≥n](#DOCS_INTRO)** para obtener informaci√≥n detallada sobre las caracter√≠sticas de la API
- Navega por la carpeta `examples/` en este proyecto para ver ejemplos de c√≥digo m√°s peque√±os y espec√≠ficos para cada caracter√≠stica
- Echa un vistazo a **[recursos de la comunidad](#DOCS_TOPICS_COMMUNITY_RESOURCES)** para herramientas espec√≠ficas de lenguaje mantenidas por miembros de la comunidad
- Lee nuestro tutorial sobre [c√≥mo alojar aplicaciones de Discord en Cloudflare Workers](#DOCS_TUTORIALS_HOSTING_ON_CLOUDFLARE_WORKERS)
- √önete al **[servidor de Desarrolladores de Discord](https://discord.gg/discord-developers)** para hacer preguntas sobre la API, asistir a eventos organizados por el equipo de la API de Discord e interactuar con otros desarrolladores.