<LocalePicker currentLocale="es-ES" />

# Creando tu primera aplicaci√≥n de Discord
Las aplicaciones de Discord te permiten personalizar y ampliar tus servidores utilizando una colecci√≥n de API y funciones interactivas. Esta gu√≠a te ense√±ar√° a crear tu primera aplicaci√≥n de Discord con JavaScript, y al final tendr√°s una aplicaci√≥n que utiliza comandos slash, env√≠a mensajes y responde a las interacciones de los componentes.

Construiremos una aplicaci√≥n de Discord que permita a los miembros del servidor jugar piedra, papel o tijera (con 7 opciones en lugar de las 3 habituales). Esta gu√≠a est√° enfocada para principiantes, pero asume que tienes una comprensi√≥n b√°sica de [JavaScript](https://developer.mozilla.org/en-US/docs/Learn/Getting_started_with_the_web/JavaScript_basics).

<Collapsible title="Lo que crearemos" icon="view">
  As√≠ ser√° el resultado de la aplicaci√≥n:

  ![Demo of example app](getting-started-demo.gif)

  Para hacer el flujo del usuario un poco m√°s expl√≠cito:
  1. El usuario 1 inicia un nuevo juego y elige su objeto utilizando el comando slash `/challenge` de la aplicaci√≥n.
  2. Se env√≠a un mensaje al canal con un bot√≥n que invita a otros a aceptar el desaf√≠o.
  3. El usuario 2 presiona el bot√≥n **Accept**.
  4. Se env√≠a un mensaje ef√≠mero al usuario 2, donde selecciona su objeto de elecci√≥n.
  5. El resultado del juego se publica nuevamente en el canal original para que todos lo vean.
</Collapsible>

<Collapsible title="Recursos utilizados en esta gu√≠a" description="Resumen de las herramientas y tecnolog√≠as que utilizaremos" icon="list">
  - **[Repositorio GitHub](https://github.com/discord/discord-example-app)** donde se encuentra el c√≥digo de esta gu√≠a, junto con algunos ejemplos de c√≥digo adicionales espec√≠ficos de caracter√≠sticas.
  - **[discord-interactions](https://github.com/discord/discord-interactions-js)**, es una biblioteca que proporciona tipos y funciones auxiliares para las aplicaciones de Discord.
  - **[Express](https://expressjs.com)**, es un framework web popular de JavaScript, que usaremos para crear un servidor donde Discord pueda enviarnos solicitudes.
  - **[Glitch](https://glitch.com/)**, es un entorno en l√≠nea que simplifica tanto la creaci√≥n como el alojamiento de aplicaciones durante las fases iniciales de desarrollo y prototipado. Tambi√©n puede desarrollar localmente con una herramienta como **[ngrok](https://ngrok.com/)**.
</Collapsible>

---

## Step 1: Crear una aplicaci√≥n

Primero, necesitas crear una aplicaci√≥n en el Developer Portal si a√∫n no tienes una:

<Button href="https://discord.com/developers/applications?new_application=true" color="brand">Crear aplicaci√≥n</Button>

Escriba un nombre para su aplicaci√≥n, luego presiona **Create**.

Despu√©s de crear tu aplicaci√≥n, llegar√°s a la p√°gina **General Information** de la aplicaci√≥n, donde podr√°s actualizar la informaci√≥n b√°sica sobre tu aplicaci√≥n, como su descripci√≥n e icono. Tambi√©n encontrar√°s un **Application ID** e **Interactions Endpoint URL**, los cuales utilizaremos m√°s adelante en esta gu√≠a.

### Configurando tu bot

A continuaci√≥n, configuraremos el [Usuario bot](#DOCS_TOPICS_OAUTH2/bot-vs-user-accounts) para tu aplicaci√≥n, lo cual le permitir√° aparecer y comportarse de manera similar a otros miembros del servidor.

En la barra de navegaci√≥n izquierda da clic en **Bot**. En esta p√°gina, puedes configurar los ajustes [privileged intents](#DOCS_TOPICS_GATEWAY/privileged-intents) o si pueden ser a√±adidos por otros usuarios.

<Collapsible title="¬øQu√© son las intents?" description="Introducci√≥n para intens est√°ndaras y privilegiadas." icon="question">
  Las intents determinan qu√© eventos enviar√° Discord a tu aplicaci√≥n cuando crees una [conexi√≥n Gateway API](#DOCS_TOPICS_GATEWAY). Por ejemplo, si quieres que tu app haga algo cuando los usuarios agreguen una reacci√≥n a un mensaje, puedes pasar la intent `GUILD_MESSAGE_REACTIONS` (`1 << 10`).

  Algunos intents tienen [privilegios](#DOCS_TOPICS_GATEWAY/privileged-intents), lo que significa que tu aplicaci√≥n tiene la capacidad de acceder a datos potencialmente confidenciales (como el contenido de los mensajes). Las intents con privilegios aparecen y se pueden alternar en la p√°gina **Bot** en la configuraci√≥n de la aplicaci√≥n. Las intents est√°ndar sin privilegios no necesitan permisos ni configuraciones adicionales.

  Para obtener m√°s informaci√≥n sobre las intents y una lista completa de las intents disponibles, junto con sus eventos asociados, consulte la [documentaci√≥n Gateway](#DOCS_TOPICS_GATEWAY/gateway-intents).
</Collapsible>

![Pesta√±a de Bot en la configuraci√≥n de la aplicaci√≥n](app-add-bot.png)

Tambi√©n hay una secci√≥n **Token** en la p√°gina **Bot**, que te permite copiar y restablecer el token de tu bot.

Los tokens de bot se utilizan para autorizar solicitudes de API y llevan los permisos de tu bot, lo que los hace *altamente sensibles*. Aseg√∫rate de *nunca* compartir tu token o ingresarlo en ning√∫n tipo de control de versiones.

Adelante, copia el token y gu√°rdalo en un lugar seguro (como en un administrador de contrase√±as).

> warn
> No podr√°s ver tu token de nuevo a menos que lo regeneres, as√≠ que aseg√∫rate de guardarlo en un lugar seguro.

### Agregando alcances y permisos de bot

Las aplicaciones necesitan la aprobaci√≥n de los usuarios que las instalan para realizar acciones en Discord (como crear un comando slash o buscar una lista de miembros del servidor). Vamos a seleccionar algunos alcances y permisos para solicitar antes de instalar la aplicaci√≥n.

<Collapsible title="¬øQu√© son los alcances y los permisos?" description="Introducci√≥n a los alcances y permisos de bot" icon="question">
  Al crear una aplicaci√≥n, los alcances y permisos determinan lo que tu aplicaci√≥n puede hacer y acceder en los servidores de Discord.

  - Los [Alcances de OAuth2](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes) determinan qu√© acceso a datos y acciones puede tomar tu aplicaci√≥n, otorgado en nombre de un usuario que instala o autentica.
  - Los [Permisos](#DOCS_TOPICS_PERMISSIONS/permission-overwrites) son los permisos asignados para tu usuario bot, los mismos que tienen otros usuarios en Discord. Pueden ser aprobados por el usuario que instala o actualiza m√°s tarde dentro de la configuraci√≥n del servidor o con [sobrescrituras de permisos](#DOCS_TOPICS_PERMISSIONS/permission-overwrites).
</Collapsible>

Haz clic en **OAuth2** en la barra lateral izquierda, luego selecciona **Generador de URL**.

> info
> El generador de URL crea un enlace de instalaci√≥n basado en los alcances y permisos que seleccionas para tu aplicaci√≥n. Puedes usar el enlace para instalar la aplicaci√≥n en tu propio servidor, o compartirlo con otros para que puedan instalarla.

Por ahora, solo agrega el alcance **`bot`**, que agrega tu usuario bot.

Despu√©s de seleccionar `bot`, tambi√©n puedes seleccionar diferentes permisos para tu bot. Por ahora, solo marca **Enviar mensajes**.

Consulta la lista de todos los [alcances de OAuth2](#DOCS_TOPICS_OAUTH2/shared-resources-oauth2-scopes), o lee m√°s sobre los [permisos](#DOCS_TOPICS_PERMISSIONS) en la documentaci√≥n.

### Instalando tu aplicaci√≥n

Una vez que agregues los alcances, deber√≠as ver una URL que puedes copiar para instalar tu aplicaci√≥n.

![Captura de pantalla del generador de URL](url-generator.png)

> info
> Cuando est√©s desarrollando aplicaciones, deber√≠as construir y probar en un servidor que no est√© siendo utilizado activamente por otros. Si a√∫n no tienes tu propio servidor, puedes [crear uno gratis](https://support.discord.com/hc/en-us/articles/204849977-How-do-I-create-a-server-).

Copia la URL de arriba y p√©gala en tu navegador. Ser√°s guiado a trav√©s del flujo de instalaci√≥n, donde debes asegurarte de que est√°s instalando tu aplicaci√≥n en un servidor donde puedas desarrollarla y probarla.

Despu√©s de instalar tu aplicaci√≥n, puedes dirigirte a tu servidor y ver que se ha unido ‚ú®

Con tu aplicaci√≥n configurada e instalada, comencemos a desarrollarla.

---

## Paso 2: Ejecutando tu aplicaci√≥n

Todo el c√≥digo utilizado en la aplicaci√≥n de ejemplo se puede encontrar en [el repositorio de GitHub](https://github.com/discord/discord-example-app).

Para simplificar un poco el desarrollo, la aplicaci√≥n utiliza [discord-interactions](https://github.com/discord/discord-interactions-js), que proporciona tipos y funciones auxiliares. Si prefieres usar otros lenguajes o bibliotecas, consulta la documentaci√≥n de [Recursos de la Comunidad](#DOCS_TOPICS_COMMUNITY_RESOURCES).

### Remixando el proyecto

Esta gu√≠a utiliza Glitch, que te permite clonar y desarrollar dentro de tu navegador. Si prefieres desarrollar tu aplicaci√≥n localmente, hay instrucciones sobre c√≥mo usar ngrok [en el README](https://github.com/discord/discord-example-app#running-app-locally).

> info
> Aunque Glitch es genial para el desarrollo y las pruebas, [tiene restricciones t√©cnicas](https://help.glitch.com/kb/article/17-technical-restrictions/) por lo que se deber√≠an considerar otros proveedores de alojamiento para aplicaciones en producci√≥n.

Para comenzar, **[remixa (o clona) el proyecto Glitch üéè](https://glitch.com/edit/#!/import/git?url=https://github.com/discord/discord-example-app.git)**.

Una vez que remezcles el proyecto, aterrizar√°s en un nuevo proyecto Glitch.

<Collapsible title="Interfaz del proyecto Glitch" description="Visi√≥n general de la interfaz del proyecto Glitch" icon="view">
  ![Visi√≥n general del proyecto Glitch](glitch-project.png)

  - Tu **nombre del proyecto** es un nombre √∫nico para tu proyecto, que se encuentra en la esquina superior izquierda
  - **`.env`** es el archivo donde se almacenar√°n todas tus credenciales para tu aplicaci√≥n
  - **Logs** es donde se encuentra la salida de tu proyecto, esto es √∫til para ver si la aplicaci√≥n est√° funcionando o informaci√≥n sobre cualquier error que encuentre tu aplicaci√≥n
  - El bot√≥n **Share** en la esquina superior derecha es donde encontrar√°s la URL del proyecto en vivo, que necesitar√°s para configurar la interactividad m√°s adelante en esta gu√≠a
</Collapsible>

#### Estructura del proyecto

Todos los archivos del proyecto est√°n en el lado izquierdo de tu proyecto Glitch. A continuaci√≥n, se muestra una descripci√≥n general de las carpetas y archivos principales:

```
‚îú‚îÄ‚îÄ examples    -> aplicaciones de muestra espec√≠ficas y cortas
‚îÇ   ‚îú‚îÄ‚îÄ app.js  -> c√≥digo finalizado de app.js
‚îÇ   ‚îú‚îÄ‚îÄ button.js
‚îÇ   ‚îú‚îÄ‚îÄ command.js
‚îÇ   ‚îú‚îÄ‚îÄ modal.js
‚îÇ   ‚îú‚îÄ‚îÄ selectMenu.js
‚îú‚îÄ‚îÄ .env        -> tus credenciales e IDs
‚îú‚îÄ‚îÄ app.js      -> punto de entrada principal para la aplicaci√≥n
‚îú‚îÄ‚îÄ commands.js -> cargas √∫tiles de comandos slash + ayudantes
‚îú‚îÄ‚îÄ game.js     -> l√≥gica espec√≠fica para RPS
‚îú‚îÄ‚îÄ utils.js    -> funciones de utilidad y enumeraciones
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ .gitignore
```

### Instalando comandos slash

> info
> Para instalar comandos slash, la aplicaci√≥n est√° utilizando [`node-fetch`](https://github.com/node-fetch/node-fetch). Puedes ver la implementaci√≥n para la instalaci√≥n en `utils.js` dentro de la funci√≥n `DiscordRequest()`.

El proyecto contiene un script `register` que puedes usar para instalar los comandos en `ALL_COMMANDS`, que se define en la parte inferior de `commands.js`. Instala los comandos como comandos globales llamando al endpoint [`PUT /applications/<APP_ID>/commands`](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/bulk-overwrite-global-application-commands) de la API HTTP.

Si quieres personalizar tus comandos o agregar otros adicionales, puedes hacer referencia a la estructura del comando en la [documentaci√≥n de comandos](#DOCS_INTERACTIONS_APPLICATION_COMMANDS/application-command-object-application-command-structure).

Ejecuta el script `register` haciendo clic en **Terminal** en la parte inferior de tu proyecto Glitch y pegando el siguiente comando:

```
npm run register
```

Presiona enter para ejecutar el comando.

Si navegas de vuelta a tu servidor, deber√≠as ver los comandos slash aparecer. Pero si intentas ejecutarlos, no suceder√° nada ya que tu aplicaci√≥n no est√° recibiendo ni manejando ninguna solicitud de Discord.

<Collapsible title="¬øQu√© son las APIs de Discord?" description="Visi√≥n general de las APIs HTTP y Gateway de Discord" icon="question">
  Discord tiene dos APIs que puedes combinar y mezclar para construir aplicaciones:

  - **[HTTP API](#DOCS_REFERENCE/http-api)** es una API tipo REST para operaciones generales como enviar y actualizar datos en Discord, o buscar datos sobre un recurso.
  - **[Gateway API](#DOCS_REFERENCE/gateway-websocket-api)** es una API basada en WebSocket que es √∫til para mantener el estado o escuchar eventos que ocurren en un servidor de Discord. No la usaremos en esta gu√≠a, pero puedes encontrar m√°s informaci√≥n sobre c√≥mo crear una conexi√≥n Gateway y los diferentes eventos que puedes escuchar en la [documentaci√≥n de Gateway](#DOCS_TOPICS_GATEWAY).
</Collapsible>

---

## Paso 3: Manejo de la interactividad

Para permitir que tu aplicaci√≥n reciba solicitudes de comandos slash (y otras interacciones), Discord necesita una URL p√∫blica para enviarlas. Esta URL se puede configurar en la configuraci√≥n de tu aplicaci√≥n como **URL del punto final de interacci√≥n**.

### Agregando una URL de punto final de interacci√≥n

Los proyectos de Glitch tienen una URL p√∫blica expuesta por defecto. Copia la URL de tu proyecto haciendo clic en el bot√≥n **Share** en la esquina superior derecha, luego copia el enlace del "sitio en vivo" que se encuentra en la parte inferior del modal.

> info
> Si est√°s desarrollando localmente, hay instrucciones para hacer tunneling de las solicitudes a tu entorno local [en el README de GitHub](https://github.com/discord/discord-example-app#running-app-locally).

Con el enlace copiado, ve a la configuraci√≥n de tu aplicaci√≥n desde [el portal de desarrolladores](https://discord.com/developers/applications).

En la p√°gina **General Information** de tu aplicaci√≥n, hay una opci√≥n **Interactive Endpoint URL**, donde puedes pegar la URL de tu aplicaci√≥n y agregar `/interactions` al final, que es donde la aplicaci√≥n Express est√° configurada para escuchar las solicitudes.

![URL de punto final de interacciones en la configuraci√≥n de la aplicaci√≥n](interactions-url.png)

Haz clic en **Save Changes** y aseg√∫rate de que tu punto final est√© verificado correctamente.

La aplicaci√≥n de ejemplo maneja la verificaci√≥n de dos maneras:
- Utiliza la `PUBLIC_KEY` y el paquete [discord-interactions](https://github.com/discord/discord-interactions-js#usage) con una funci√≥n de envoltura (importada de `utils.js`) que la hace cumplir con la interfaz `verify` de [Express](http://expressjs.com/en/5x/api.html#express.json). Esto se ejecuta en cada solicitud entrante a tu aplicaci√≥n.
- Responde a las solicitudes `PING` entrantes.

Puedes aprender m√°s sobre c√≥mo preparar tu aplicaci√≥n para recibir interacciones en [la documentaci√≥n de interacciones](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/receiving-an-interaction).

### Manejando las solicitudes de comandos slash

Con el punto final verificado, navega al archivo `app.js` de tu proyecto y encuentra el bloque de c√≥digo que maneja el comando `/test`:

```javascript
// Comando "test"
if (name === 'test') {
    // Env√≠a un mensaje al canal desde donde se activ√≥ el comando
    return res.send({
    type: InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE,
    data: {
        // Obtiene un emoji aleatorio para enviar desde una funci√≥n auxiliar
        content: 'hola mundo ' + getRandomEmoji(),
    },
    });
}
```

El c√≥digo anterior est√° respondiendo a la interacci√≥n con un mensaje en el canal desde donde se origin√≥. Puedes ver todos los tipos de respuesta disponibles, como responder con un modal, [en la documentaci√≥n](#DOCS_INTERACTIONS_RECEIVING_AND_RESPONDING/interaction-response-object-interaction-callback-type).

> info
> `InteractionResponseType.CHANNEL_MESSAGE_WITH_SOURCE` es una constante [exportada desde `discord-interactions`](https://github.com/discord/discord-interactions-js/blob/main/src/index.ts#L33)

Ve a tu servidor y aseg√∫rate de que el comando slash `/test` de tu aplicaci√≥n funciona. Cuando lo activas, tu aplicaci√≥n deber√≠a enviar un mensaje que contiene "hola mundo" seguido de un emoji aleatorio.

En la siguiente secci√≥n, agregaremos un comando adicional que utiliza opciones de comandos slash, botones y men√∫s de selecci√≥n para construir el juego de piedra-papel-tijeras.

---